<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Service Gateway</title> 
    <meta name="description" content="Error 404">
    <meta name="robots" content="noindex, nofollow, noarchive">

    <!-- üé® STACK -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Montserrat:wght@600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --bg-deep: #050505;
            --bg-card: #111111;
            --accent: #F59E0B;
            --accent-dim: rgba(245, 158, 11, 0.15);
            --text-main: #FFFFFF;
            --text-muted: #9CA3AF;
            --border: #222222;
        }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        h1, h2, h3, .brand-font { font-family: 'Montserrat', sans-serif; letter-spacing: -0.02em; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }

        .titanium-card {
            background: linear-gradient(145deg, #151515, #0a0a0a);
            border: 1px solid var(--border);
            border-radius: 16px;
        }

        .nav-glass {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(12px);
            border-top: 1px solid var(--border);
        }

        .btn-main {
            background: linear-gradient(to right, #F59E0B, #D97706);
            color: black;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-radius: 10px;
        }

        .btn-upsell {
            background: linear-gradient(to right, #ec4899, #8b5cf6);
            color: white;
            font-weight: 800;
            text-transform: uppercase;
            border-radius: 10px;
        }

        /* --- MARKET TICKER --- */
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
            background: #080808;
            border-bottom: 1px solid #222;
            padding: 8px 0;
        }
        .marquee-content {
            display: inline-block;
            animation: marquee 30s linear infinite;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: #ccc;
        }
        .ticker-item { margin-right: 40px; display: inline-flex; align-items: center; gap: 8px; }
        .ticker-up { color: #10b981; }
        .ticker-down { color: #ef4444; }

        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* --- INTRO --- */
        #intro-layer {
            position: fixed; inset: 0; z-index: 100;
            background: black;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .loading-line {
            width: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            margin-top: 40px;
            animation: lineExpand 2s ease-out forwards 0.5s;
        }
        @keyframes lineExpand { 0% { width: 0; opacity: 0; } 100% { width: 150px; opacity: 0; } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="antialiased">

<!-- GATEKEEPER SCREEN -->
<div id="access-denied-screen" class="hidden fixed inset-0 z-[200] bg-black flex flex-col items-center justify-center text-center p-8">
    <div class="w-20 h-20 bg-red-900/20 rounded-full flex items-center justify-center mb-6 border border-red-900/50">
        <span class="text-4xl">üõ°Ô∏è</span>
    </div>
    <h1 class="text-2xl font-black brand-font text-red-600 mb-4 tracking-widest uppercase">ACC√àS REFUS√â</h1>
    <p class="text-xs text-gray-500 max-w-sm font-mono leading-relaxed">
        CONNEXION NON S√âCURIS√âE D√âTECT√âE.<br>
        CE PORTAIL EST ACCESSIBLE UNIQUEMENT VIA LE R√âSEAU TELEGRAM.
    </p>
</div>

<!-- INTRO -->
<div id="intro-layer">
    <div class="logo-container">
        <img src="https://res.cloudinary.com/dlmmylat6/image/upload/v1765067656/Sans_titre_Logo_wjtljl.png" class="w-32 h-32 object-contain" alt="Logo">
    </div>
    <div class="loading-line"></div>
    <p class="mt-4 text-[10px] text-gray-600 tracking-[0.3em] uppercase">Secure Access</p>
</div>

<!-- APP -->
<div id="app-container" class="hidden flex flex-col h-screen pb-20 overflow-hidden">
    <!-- Background -->
    <div class="fixed inset-0 z-[-2] bg-black">
        <div class="w-full h-full object-cover opacity-20 bg-[url('https://res.cloudinary.com/dlmmylat6/image/upload/v1765419450/Sans_titre_Bannie%CC%80re_moyenne_US_Paysage_1_gpbddu.png')] bg-cover bg-center"></div>
    </div>

    <header class="bg-black/80 backdrop-blur-md z-40 border-b border-white/5">
        <div class="h-14 px-5 flex items-center justify-between">
            <div class="flex items-center gap-3" onclick="router('menu')">
                <img src="https://res.cloudinary.com/dlmmylat6/image/upload/v1765067656/Sans_titre_Logo_wjtljl.png" class="h-10">
                <div>
                    <h1 class="text-xs font-black text-white uppercase tracking-wider">South Valley</h1>
                    <div class="flex items-center gap-1.5">
                        <div id="status-dot" class="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                        <span id="status-text" class="text-[8px] font-bold text-gray-400">CHARGEMENT...</span>
                    </div>
                </div>
            </div>
            <div class="text-xl">‚ö°</div>
        </div>

        <div class="marquee-container">
            <div class="marquee-content" id="live-ticker">
                <span class="ticker-item">INITIALISATION FLUX MARCH√â...</span>
            </div>
        </div>
    </header>

    <main id="main-view" class="flex-1 overflow-y-auto px-4 py-6 space-y-6">
        <!-- Content injected here -->
    </main>

    <!-- NAVBAR -->
    <nav class="nav-glass fixed bottom-0 w-full h-16 flex justify-around items-center z-50">
        <button onclick="router('menu')" class="flex flex-col items-center opacity-50 transition-all" id="nav-menu">
            <span class="text-xl">üè†</span>
            <span class="text-[9px] font-bold uppercase">QG</span>
        </button>
        <button onclick="router('products')" class="flex flex-col items-center opacity-50 transition-all" id="nav-products">
            <span class="text-xl">üìã</span>
            <span class="text-[9px] font-bold uppercase">Menu</span>
        </button>
        <button onclick="router('cart')" class="flex flex-col items-center opacity-50 transition-all relative" id="nav-cart">
            <span class="text-xl">üõçÔ∏è</span>
            <span id="cart-dot" class="absolute top-0 right-0 w-2 h-2 bg-orange-500 rounded-full hidden"></span>
            <span class="text-[9px] font-bold uppercase">Panier</span>
        </button>
        <button onclick="router('infos')" class="flex flex-col items-center opacity-50 transition-all" id="nav-infos">
            <span class="text-xl">üì°</span>
            <span class="text-[9px] font-bold uppercase">Infos</span>
        </button>
    </nav>
</div>

<!-- MODAL PRODUIT -->
<div id="product-modal" class="fixed inset-0 z-[60] bg-black/90 hidden flex items-end justify-center backdrop-blur-sm">
    <div id="modal-content" class="bg-[#111] w-full max-w-md h-[80vh] rounded-t-3xl border-t border-white/10 flex flex-col transform translate-y-full transition-transform duration-300">
        <div class="relative h-48 w-full bg-black rounded-t-3xl overflow-hidden shrink-0">
            <img id="modal-image" class="w-full h-full object-cover opacity-60" src="">
            <button onclick="closeModal()" class="absolute top-4 right-4 bg-black/50 w-8 h-8 rounded-full">‚úï</button>
        </div>
        <div class="p-6 flex-1 overflow-y-auto">
            <h2 id="modal-title" class="text-xl font-black text-white uppercase mb-2"></h2>
            <p id="modal-desc" class="text-xs text-gray-400 mb-6"></p>
            <div id="tiers-list" class="space-y-2"></div>
        </div>
    </div>
</div>

<script>
    const CONFIG = {
        ADMIN: "33759840764",
        CURRENCY: "‚Ç¨"
    };

    let cart = [];

    // --- LOGIQUE TICKER ---
    async function updateTicker() {
        const el = document.getElementById('live-ticker');
        const comms = [
            '<span class="ticker-item">üîí CRYPTO = 0 TRACE BANCAIRE</span>',
            '<span class="ticker-item">üìâ PRIX D√âGRESSIFS AUTO</span>',
            '<span class="ticker-item">‚ö° LIVRAISON 24/48H</span>'
        ];
        
        try {
            const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,tether&vs_currencies=eur&include_24hr_change=true');
            const data = await res.json();
            const btc = data.bitcoin;
            comms.push(`<span class="ticker-item">BTC: <span class="text-white">${Math.floor(btc.eur)}‚Ç¨</span> <span class="${btc.eur_24h_change >= 0 ? 'ticker-up' : 'ticker-down'}">${btc.eur_24h_change.toFixed(1)}%</span></span>`);
        } catch(e) {}
        
        el.innerHTML = comms.join('').repeat(3);
    }

    // --- ROUTER ---
    function router(view) {
        const main = document.getElementById('main-view');
        // Reset nav opacity
        ['menu', 'products', 'cart', 'infos'].forEach(id => {
            document.getElementById('nav-' + id).style.opacity = '0.5';
        });
        document.getElementById('nav-' + view).style.opacity = '1';

        if(view === 'menu') renderMenu();
        if(view === 'products') renderProducts();
        if(view === 'cart') renderCart();
        if(view === 'infos') renderInfos();
    }

    const CATALOG = [
        {
            id: 'WZ-ALL', name: "Olives Wizard Treez - Frozen Sift üßä", 
            desc: "üá∫üá∏ CALI CONNECTION EXCLUSIVE üá∫üá∏\nFROZEN SIFT PREMIUM - COLD CURED STORAGE\nVari√©t√©s: Honey Banana, Dream Queen, Forbidden Fruits...",
            image: "https://res.cloudinary.com/dlmmylat6/image/upload/v1765993841/IMG_2073_ffmyfd.jpg",
            tiers: [{w:'5G (1/2)',p:80},{w:'10G (1)',p:170}]
        },
        {
            id: 'PK', name: "Pink Kush üá∫üá∏", 
            desc: "Import Cali Top Shelf. Puissance et ar√¥mes garantis.",
            image: "https://res.cloudinary.com/dlmmylat6/image/upload/v1765419450/Sans_titre_Bannie%CC%80re_moyenne_US_Paysage_1_gpbddu.png",
            tiers: [{w:'5G',p:60},{w:'10G',p:120},{w:'25G',p:220}]
        }
    ];

    function renderMenu() {
        document.getElementById('main-view').innerHTML = `
            <div class="titanium-card p-5 mb-4">
                <h2 class="brand-font text-xl font-black mb-2 uppercase italic text-orange-500">Bienvenue au QG</h2>
                <p class="text-xs text-gray-400">S√©lectionne tes produits et valide ta commande en quelques clics via Telegram.</p>
            </div>
            <div class="grid grid-cols-1 gap-4">
                <div class="titanium-card p-4 flex justify-between items-center" onclick="router('products')">
                    <span class="font-bold">VOIR LE MENU COMPLET</span>
                    <span>‚û°Ô∏è</span>
                </div>
            </div>
        `;
    }

    function renderProducts() {
        let html = CATALOG.map(p => `
            <div class="titanium-card overflow-hidden flex flex-col" onclick="openModal('${p.id}')">
                <img src="${p.image}" class="h-32 w-full object-cover">
                <div class="p-4">
                    <h3 class="font-black text-sm uppercase">${p.name}</h3>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-[10px] text-gray-500 uppercase tracking-widest">√Ä partir de</span>
                        <span class="text-orange-500 font-bold">${p.tiers[0].p}‚Ç¨</span>
                    </div>
                </div>
            </div>
        `).join('');
        document.getElementById('main-view').innerHTML = `<div class="grid grid-cols-2 gap-3">${html}</div>`;
    }

    function openModal(id) {
        const p = CATALOG.find(x => x.id === id);
        document.getElementById('modal-title').innerText = p.name;
        document.getElementById('modal-desc').innerText = p.desc;
        document.getElementById('modal-image').src = p.image;
        
        let tiersHtml = p.tiers.map(t => `
            <button onclick="addToCart('${p.id}', '${t.w}', ${t.p})" class="w-full bg-white/5 border border-white/10 p-3 rounded-xl flex justify-between items-center hover:bg-orange-500/20 transition-colors">
                <span class="font-bold">${t.w}</span>
                <span class="text-orange-500 font-black">${t.p}‚Ç¨</span>
            </button>
        `).join('');
        
        document.getElementById('tiers-list').innerHTML = tiersHtml;
        document.getElementById('product-modal').classList.remove('hidden');
        setTimeout(() => document.getElementById('modal-content').style.transform = 'translateY(0)', 10);
    }

    function closeModal() {
        document.getElementById('modal-content').style.transform = 'translateY(100%)';
        setTimeout(() => document.getElementById('product-modal').classList.add('hidden'), 300);
    }

    function addToCart(id, weight, price) {
        const p = CATALOG.find(x => x.id === id);
        cart.push({ name: p.name, weight, price });
        document.getElementById('cart-dot').classList.remove('hidden');
        closeModal();
    }

    function renderCart() {
        if(cart.length === 0) {
            document.getElementById('main-view').innerHTML = `<div class="text-center py-20 opacity-30 font-bold">PANIER VIDE</div>`;
            return;
        }
        let total = cart.reduce((sum, item) => sum + item.price, 0);
        let itemsHtml = cart.map((item, idx) => `
            <div class="flex justify-between items-center bg-white/5 p-3 rounded-lg border border-white/5">
                <div>
                    <div class="text-xs font-bold uppercase">${item.name}</div>
                    <div class="text-[10px] text-gray-500">${item.weight}</div>
                </div>
                <div class="flex items-center gap-4">
                    <span class="font-bold text-orange-500">${item.price}‚Ç¨</span>
                    <button onclick="removeItem(${idx})" class="text-red-500 text-xs">‚úï</button>
                </div>
            </div>
        `).join('');

        document.getElementById('main-view').innerHTML = `
            <h2 class="brand-font font-black mb-4">TON PANIER</h2>
            <div class="space-y-3 mb-6">${itemsHtml}</div>
            <div class="titanium-card p-4">
                <div class="flex justify-between mb-4">
                    <span class="text-gray-400">TOTAL</span>
                    <span class="text-xl font-black text-orange-500">${total}‚Ç¨</span>
                </div>
                <button onclick="checkout()" class="btn-main w-full py-4">VALIDER SUR TELEGRAM</button>
            </div>
        `;
    }

    function removeItem(idx) {
        cart.splice(idx, 1);
        if(cart.length === 0) document.getElementById('cart-dot').classList.add('hidden');
        renderCart();
    }

    function checkout() {
        let text = "üö® NOUVELLE COMMANDE üö®\n\n";
        cart.forEach(i => text += `‚ñ™Ô∏è ${i.name} - ${i.weight} (${i.price}‚Ç¨)\n`);
        text += `\nüí∞ TOTAL: ${cart.reduce((sum, item) => sum + item.price, 0)}‚Ç¨`;
        
        const url = `https://wa.me/${CONFIG.ADMIN}?text=${encodeURIComponent(text)}`;
        // Ici on peut aussi rediriger vers Telegram si tu as un bot ou lien direct
        window.open(url, '_blank');
    }

    function renderInfos() {
        document.getElementById('main-view').innerHTML = `
            <div class="space-y-4">
                <div class="titanium-card p-4">
                    <h3 class="font-bold text-orange-500 mb-2">üì¶ LIVRAISON</h3>
                    <p class="text-xs text-gray-400">Exp√©dition discr√®te 24/48h. Suivi fourni d√®s l'envoi.</p>
                </div>
                <div class="titanium-card p-4">
                    <h3 class="font-bold text-blue-400 mb-2">‚Çø PAIEMENT CRYPTO</h3>
                    <p class="text-xs text-gray-400">Nous acceptons BTC, LTC et USDT. Z√©ro trace sur ton relev√© bancaire.</p>
                </div>
            </div>
        `;
    }

    // --- INIT ---
    window.onload = () => {
        const tg = window.Telegram?.WebApp;
        // Protection: Uniquement si dans Telegram (initData pr√©sent)
        const isSecure = (tg && tg.initData && tg.initData.length > 0) || location.hostname === 'localhost';

        if (!isSecure) {
            document.getElementById('intro-layer').style.display = 'none';
            document.getElementById('access-denied-screen').classList.remove('hidden');
            return;
        }

        if(tg) {
            tg.expand();
            tg.ready();
        }

        updateTicker();
        document.getElementById('status-text').innerText = "OP√âRATIONNEL";

        setTimeout(() => {
            document.getElementById('intro-layer').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('intro-layer').style.display = 'none';
                document.getElementById('app-container').classList.remove('hidden');
                router('menu');
            }, 800);
        }, 2500);
    };
</script>
</body>
</html>
